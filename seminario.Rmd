---
title: "seminario fuentes sobre el impacto del agua y el tabaquismo en el cancer de colon"
subtitle: "Fuentes de datos Biomédicas y Web semántica, Grado de Ingeniería de la Salud"
author: "Álvaro Martín,Miguel Soriano, Andres Arribas"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# **Introducción**
El cáncer de colon es una de las enfermedades oncológicas más comune, la cual ocasiona incontables perdidas cada año en todo el mundo. A lo largo de este proyecto, tratamos distintas bases de datos donde se estudia su prevalencia, su imapcto y como se relaciona con dos importantes factores que afectan a la salud: el tabaquismo y la calidad del agua.

Por un lado, el tabaquismo, ampliamente estudiado como factor de riesgo para diferentes tipos de cáncer, afectando tambien al colon, dado que las sustancias químicas del tabaco dañan las células intestinales, promoviendo su crecimiento anormal.

Por otro lado, la calidad del agua también es crucial en la salud gastrointestinal ya que suexposición a químicos nocivos puede afectar negativamente la salud digestiva.

Hemos elegido centrarnos solo en la region de asturias en españa dados los datos encontrados para explorar esta posible relacion entre estos dos factores y el cancer de colon

## **Objetivos**
El propósito principal de este estudio es explorar y entender la relación entre el tabaquismo, la calidad del agua, y la incidencia del cáncer de colon en la region de asturias. Para lograr esto, hemos establecido los siguientes objetivos específicos:

1. **Analizar la prevalencia del tabaquismo**: Estudiar la prevalencia del tabaquismo en la region de asturias y su correlación con la incidencia del cáncer de colon.

2. **Evaluar la calidad del agua**: Investigar la calidad del agua en la region de asturias y su posible relación con la incidencia del cáncer de colon.

3. **Investigar la incidencia del cáncer de colon**: Analizar la incidencia del cáncer en la region de asturias y su posible correlación con el tabaquismo y la calidad del agua.

4. **Explorar la interacción entre estos factores**: Investigar cómo el tabaquismo y la calidad del agua pueden interactuar entre sí y su impacto conjunto en la incidencia del cáncer de colon basandonos en los datos hallados de la region de asturias.

A través de estos objetivos, esperamos proporcionar una visión más completa de cómo estos factores pueden influir en la salud humana y contribuir al conocimiento de la incidencia del cáncer de colon.

# Importación de las librerias necesarias 
En este apartado añadimos todas las librerias necesarias para realizar el trabajo
```{r}
library(tidyverse)
library(readxl)
library(readr)
library(jsonlite)
library(dplyr)
library(tidyr)
```
# Importacion de las fuentes de datos 

En este apartado añadimos las diferentes fuentes de datos que hemos utilizado para el estudio directamente utilizando los formatos csv y JSON para poder manipular los datos
```{r}
#esta base de datos tiene informacion pero no es relevante al ser del pais vasco
#carga de datos xlsx sobre calidad de agua en pais vasco
datos_paisVasco <- read_excel("INPUT/DATA/control_analitico.xlsx")
str(datos_paisVasco)
summary(datos_paisVasco)
View(datos_paisVasco)

#carga de datos csv sobre calidad de agua en gijon
Agua_gijon <- read_delim("INPUT/DATA/731.csv", 
                      delim = ",", escape_double = FALSE, trim_ws = TRUE)
Agua_gijon
summary(Agua_gijon)
View(Agua_gijon)
table(Agua_gijon$T.RED)

# Cargar el archivo JSON de fumadores
datos_fumadores <- fromJSON("INPUT/DATA/Fumadores.json", flatten = TRUE) %>%
  as_tibble()

# Separar la columna 'Nombre' y filtrar por región
fumadores_asturias <- datos_fumadores %>%
  separate(Nombre, into = c("Sexo", "Region", "Categoria"), sep = ", ", fill = "right") %>%
  filter(Region == "Asturias (Principado de)")

# Extraer el primer valor de cada lista en MetaData y Data, si hay múltiples valores
fumadores_asturias_expandido <- fumadores_asturias %>%
  mutate(
    Variable_Nombre = map(MetaData, ~ .x[["Variable.Nombre"]][1]),
    Variable_Codigo = map(MetaData, ~ .x[["Variable.Codigo"]][1]),
    Valor = map(Data, ~ .x[["Valor"]][1])
  ) %>%
  # Convertir las listas resultantes en columnas de caracteres para un dataframe limpio
  unnest(c(Variable_Nombre, Variable_Codigo, Valor))

# Seleccionar columnas relevantes
fumadores_asturias_final <- fumadores_asturias_expandido %>%
  select(Sexo, Region, Categoria, Variable_Nombre, Variable_Codigo, Valor)

# Verificar los resultados
View(fumadores_asturias_final)
summary(fumadores_asturias_final)

#carga de datos xlsx sobre algunas enfermedades en asturias, entre ellas el cancer de colon
datosEnfermedades <-  read_excel("INPUT/DATA/03009d.xlsx")
str(datosEnfermedades)
summary(datosEnfermedades)
View(datosEnfermedades)

```

# Cambios en las fuentes de datos
Este paso es necesario ya que al relacionar todas las tablas entre si necesitamos que aquellas columnas que son comunes tengan los mismos nombres, por ello se ha requerido que todos los nombres de las comunidades y ciudades autonomas presentes sean cambiados a nombres comunes elegidos por el grupo. Por otro lado hemos usado el select para seleccionar las columnas de datos que nos resultan de interes para el estudio.

```{r}
agua_gijon <- agua_gijons%>%
  mutate(
    CCAA= case_when( ## cambiamos el nombre con un case_When
      fumadores$`Comunidades y Ciudades Autónomas`== "Andalucía" ~ "Andalucia",
      fumadores$`Comunidades y Ciudades Autónomas`== "Aragón" ~ "Aragon",
      fumadores$`Comunidades y Ciudades Autónomas`== "Asturias (Principado de)" ~ "Asturias",
      fumadores$`Comunidades y Ciudades Autónomas`== "Balears (Illes)" ~ "Baleares",
      fumadores$`Comunidades y Ciudades Autónomas`== "Canarias" ~ "Canarias",
      fumadores$`Comunidades y Ciudades Autónomas`== "Cantabria" ~ "Cantabria",
      fumadores$`Comunidades y Ciudades Autónomas`== "Castilla y León" ~ "CyL",
      fumadores$`Comunidades y Ciudades Autónomas`== "Castilla - La Mancha" ~ "Castilla la Mancha",
      fumadores$`Comunidades y Ciudades Autónomas`== "Cataluña" ~ "Cataluña",
      fumadores$`Comunidades y Ciudades Autónomas`== "Comunitat Valenciana" ~ "C.Valencia",
      fumadores$`Comunidades y Ciudades Autónomas`== "Extremadura" ~ "Extremadura",
      fumadores$`Comunidades y Ciudades Autónomas`== "Galicia" ~ "Galicia",
      fumadores$`Comunidades y Ciudades Autónomas`== "Madrid (Comunidad de)" ~ "Madrid",
      fumadores$`Comunidades y Ciudades Autónomas`== "Murcia (Región de)" ~ "Murcia",
      fumadores$`Comunidades y Ciudades Autónomas`== "Navarra (Comunidad Foral de)" ~ "Navarra",
      fumadores$`Comunidades y Ciudades Autónomas`== "País Vasco" ~ "País Vasco",
      fumadores$`Comunidades y Ciudades Autónomas`== "Rioja (La)" ~ "La Rioja",
      fumadores$`Comunidades y Ciudades Autónomas`== "Ceuta (Ciudad Autónoma de)" ~ "Ceuta",
      fumadores$`Comunidades y Ciudades Autónomas`== "Melilla (Ciudad Autónoma de)" ~ "Melilla",
    )) %>%
select(`CCAA`,`Consumo de tabaco`,Total,) %>%
  na.exclude()%>%
  filter(`Consumo de tabaco` != "TOTAL")
fumadores
      
```


